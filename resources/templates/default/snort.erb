<%####################################################################### %>
<%# Copyright (c) 2014 ENEO TecnologÃ­a S.L. %>
<%# This file is part of redBorder. %>
<%# redBorder is free software: you can redistribute it and/or modify %>
<%# it under the terms of the GNU Affero General Public License License as published by %>
<%# the Free Software Foundation, either version 3 of the License, or %>
<%# (at your option) any later version. %>
<%# redBorder is distributed in the hope that it will be useful, %>
<%# but WITHOUT ANY WARRANTY; without even the implied warranty of %>
<%# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the %>
<%# GNU Affero General Public License License for more details. %>
<%# You should have received a copy of the GNU Affero General Public License License %>
<%# along with redBorder. If not, see <http://www.gnu.org/licenses/>. %>
<%####################################################################### %>
###############################################################################
## Generated by Chef for <%= node[:hostname] %>
################################################################################
DAEMON_COREFILE_LIMIT='unlimited'
INTERFACES="<%= @group["segments"].join(",") %>"
CPU_LIST="<%= @group["cpu_list"].sort.join(",") %>"
CONF="/etc/snort/<%= @group["instances_group"] %>/snort.conf"
INSTANCES_GROUP="<%= @group["instances_group"] %>"
INSTANCES_GROUP_NAME="<%= @name %>"
USER="snort"
GROUP="snort"
LOGDIR="/var/log/snort/<%= @group["instances_group"] %>"
SYSLOG="/var/log/messages"
NO_PACKET_LOG=0
PRINT_INTERFACE=0
SECS=5
PFRING_CLUSTERMODE=<%= ( ( !@group["pfring_clustermode"].nil? and (@group["pfring_clustermode"].to_i==2 or @group["pfring_clustermode"].to_i==4 or @group["pfring_clustermode"].to_i==5 or @group["pfring_clustermode"].to_i==6 )  ) ? @group["pfring_clustermode"].to_s :  "2" ) %>
PFRING_WATERMARK=<%= ( ( @group["pfring_watermark"].nil? or @group["pfring_watermark"].to_i<=0 ) ? "16" : [ [ @group["pfring_watermark"].to_i, 256 ].min, 1].max.to_s ) %>
AUTOBYPASS=<%= (@group["autobypass"].nil? ? "0" : ( ( @group["autobypass"] ) ? "1" : "0" )) %>
<%- if @group["mode"] != "IPS" %>
FORCE_ALERT=1
#SEND_ENOBUF_USECS=1
#SEND_ENOBUF_ATTEMPTS=1000
<%- else %>
FORCE_ALERT=0
<%- end %>
SNORT_MODE="<%= @group["mode"] %>"
<%- if @group["mode"] != "IDS" and @group["mode"] != "IDS_SPAN" and @group["mode"] != "IDS_FWD" %>
INLINE=1
<%- else %>
INLINE=0
<%- end %>
<%- if @group["mode"] == "IPS_TEST" %>
INLINE_TEST=1
#SEND_ENOBUF_USECS=1
#SEND_ENOBUF_ATTEMPTS=1000
<%- else %>
INLINE_TEST=0
<%- end %>
<%- if @group["mode"] == "IDS_SPAN" %>
IDS_SPAN=1
<%- else %>
IDS_SPAN=0
<%- end %>
PFRING_BESTEFFORT=<%= ( @group["pfring_besteffort"] == 1 or @group["pfring_besteffort"]=="1" or @group["pfring_besteffort"]==true ) ? "1" : "0" %>
PFRING_BESTEFFORT_MINNUMSLOTS=<%= @group["pfring_besteffort_minnumslots"].nil? ? "8192" : [(@group["pfring_besteffort_minnumslots"].to_i/8192).to_i * 8192, 8192 ].max.to_s %>
<% if @group["pfring_sbypass_profile"] == "1" %>
# connectivity
PFRING_SBYPASS=1
PFRING_SBYPASS_UPPERTHRESHOLD=60
PFRING_SBYPASS_LOWERTHRESHOLD=10
PFRING_SBYPASS_SAMPLINGRATE=5000
<% elsif @group["pfring_sbypass_profile"] == "2" %>
# balanced
PFRING_SBYPASS=1
PFRING_SBYPASS_UPPERTHRESHOLD=75
PFRING_SBYPASS_LOWERTHRESHOLD=25
PFRING_SBYPASS_SAMPLINGRATE=2000
<% elsif @group["pfring_sbypass_profile"] == "3" %>
# security
PFRING_SBYPASS=1
PFRING_SBYPASS_UPPERTHRESHOLD=90
PFRING_SBYPASS_LOWERTHRESHOLD=40
PFRING_SBYPASS_SAMPLINGRATE=2000
<% else %>
# disabled
PFRING_SBYPASS=0
PFRING_SBYPASS_UPPERTHRESHOLD=
PFRING_SBYPASS_LOWERTHRESHOLD=
PFRING_SBYPASS_SAMPLINGRATE=
<% end %>
